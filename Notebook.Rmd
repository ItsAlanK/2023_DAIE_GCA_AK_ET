---
title: "Virtual Reality Interventions: Evaluating Efficacy in the Treatment of GAD"
author: "Alan Kinsella, Erik Trujillo"
date: "13/12/2023"
output: html_document
---

<!-- This is what a comment looks like-->
### Table of Contents

<!-- 1. [Setup](#setup)
2. [Data Loading](#data-load) -->
1. [Abstract](#abstract)
2. [Introduction](#introduction)
3. [Initial Inspection](#inspection)
4. [Data Cleanup](#cleanup) 
5. [Method](#method)
6. [Results](#results)
7. [Discussion](#discussion)
8. [References](#references)

<!-- ### Setup <a name="setup"></a> -->
```{r include=FALSE}

# install.packages("tidyverse")
if(!require("knitr"))
library(knitr)

# Load the packages, loading tidyverse for readr, dplyr, magrittr, and ggplot2
if(!require("tidyverse"))
library(tidyverse)

if(!require("nortest"))
  install.packages("nortest")
library(nortest)
```


```{r include=FALSE} 
#Setting this up to define all chunks to show both code and output: 
knitr::opts_chunk$set(echo = TRUE)

```

<!-- ### Data Loading <a name="data-load"></a> -->
<!-- Loading our Datasets into R Studio -->
```{r include=FALSE} 
control_group <- read_csv("GROUP_12_2023_GCA_RESULTS_CONTROL.csv")
experimental_group <- read_csv("GROUP_12_2023_GCA_RESULTS_EXPERIMENTAL.csv")

```


### Abstract <a name="abstract"></a>




### Introduction <a name="introduction"></a>
As of 2019, approximately 301 million people globally suffer from anxiety disorders, characterized by persistent feelings of anxiety and fear. Virtual Reality (VR) has emerged as a promising therapeutic tool, offering immersive exposure experiences for controlled treatment. Studies demonstrate VR's effectiveness in reducing symptoms of post-traumatic stress disorder and acrophobia, indicating its transformative potential in anxiety disorder treatments. Non-pharmacological therapies, notably Cognitive Behavioral Therapy, are commonly used for Generalized Anxiety Disorder (GAD), employing approaches like Imaginal Exposure Therapy and Stress Inoculation Training. Severity assessment often involves self-report mechanisms such as the State-Trait Anxiety Inventory and Generalized Anxiety Disorder 7-item scale, both scaled from 0 to 10, contributing to a nuanced understanding of anxiety disorders and guiding tailored therapeutic interventions.

This study will look at the results of an experiment comparing GAD and STAI scores of patients treated using traditional CBT (Control Group) and VR Therapy (Experimental Group) to identify the degree to which VR therapy has an effect compartive to proven therapy techniques.


### Initial Inspection <a name="inspection"></a>
Initial inspection shows the same data types on both datasets. Patients are categorized by gender, and there are numeric scores for Generalized Anxiety Disorder (GAD) and State-Trait Anxiety Inventory (STAI). We have results both for pretrial testing and post trial testing. 

```{r echo=FALSE} 
# Display the first few rows of the datasets (Removes 3rd row which just shows data types)
# Ref for how to remove data types: https://stackoverflow.com/questions/64734495/suppressing-the-column-classes-for-tibbles
```

#### Control Group
```{r echo=FALSE} 
cat(format(head(control_group))[-3L], sep = "\n")
```

#### Experimental Group
```{r echo=FALSE} 
cat(format(head(experimental_group))[-3L], sep = "\n")
```

The summary is showing some insight on how the data is distributed, there are also some outliers visible within the minimum values that might need to be looked at during our cleaning process. We need to first understand if negative values are possible in this type of results.

<!-- Summary of the datasets -->
#### Summary of Control Group
```{r echo=FALSE} 
 summary(control_group)
```

#### Summary of Experimental Group
```{r echo=FALSE} 
 summary(experimental_group)
```

### Data Cleanup <a name="cleanup"></a>
```{r include=FALSE}
# Check for missing values
cntlMissingCount <- sum(is.na(control_group)) 
expMissingCount <- sum(is.na(experimental_group)) 

# Verifying data types 
cntlDataTypes <- str(control_group) 
expDataTypes <- str(experimental_group) 

```


During the data cleanup stage we checked for any missing values and found `r cntlMissingCount` missing values in the control group and `r expMissingCount` missing values in the experimental group meaning no participants need to be removed for lack of data.

Upon inspecting data types by viewing the structure of the data, all data types match what they should:

- Patient ID, and test results are all numbers
- Gender are all character strings


#### Filtering values outside of test boundaries 
<!-- Filters each group to new dataset removing any results outside of what test results can be -->
<!-- GAD 0 - 21, STAI 20 - 80-->
```{r echo=FALSE}

# Converting PatientID numbers intro character strings to not get numerical data in the summary. 
control_group <- control_group %>% 
mutate(patientID = as.character(patientID))

control_group_cleaned <- control_group %>% filter(pretrial_GAD >= 0, pretrial_STAI >= 20, posttrial_GAD >= 0, posttrial_STAI >= 20, pretrial_GAD <= 21, pretrial_STAI <= 80, posttrial_GAD <= 21, posttrial_STAI <= 80)
```

``` {r echo=FALSE}

# Converting PatientID numbers intro character strings to not get numerical data in the summary. 
experimental_group <- experimental_group %>% 
mutate(patientID = as.character(patientID))

experimental_group_cleaned <- experimental_group %>% filter(pretrial_GAD >= 0, pretrial_STAI >= 0, posttrial_GAD >= 0, posttrial_STAI >= 0, , pretrial_GAD <= 21, pretrial_STAI <= 80, posttrial_GAD <= 21, posttrial_STAI <= 80) 
```



Data has also been cleaned above to remove any test responses outside of the test boundaries. GAD test have a lower score limit of 0 and an upper limit of 21, while STAI has a lower and upper limit of 20 and 80 respectively. When compared to earlier data chunks we can see that no values min or max for any test lie outside of expected results now and we have no invalid values either. See [references for sources on test boundaries](#references)

#### Summary of Control Group After Cleanup
``` {r echo=FALSE}
summary(control_group_cleaned) 
```

#### Summary of Experimental Group After Cleanup
``` {r echo=FALSE}
summary(experimental_group_cleaned) 
```

```{r include=FALSE}
count_control_cleaned <- count(control_group_cleaned)
count_experimental_cleaned <- count(experimental_group_cleaned)
```

After cleaning, the count of results remained even with `r count_control_cleaned` results for both control and experimental group so further sampling is not required.

### Hypothesis Formulation

After our initial inspection of the data, based on the  difference in means from the pretrial results and the post trial results, we have come to following hypothesis:

- **Null Hypothesis (H0):** VR-based therapy does not have a significant difference in effectiveness from traditional CBT therapy in treating Generalized Anxiety Disorder (GAD).

- **Alternative Hypothesis (H1):** VR-based therapy is significantly more effective than traditional CBT therapy to threat Generalized Anxiety Disorder (GAD).

### Data deep dive 


#### Visual Inspection of Normality
``` {r echo=TRUE}
# Adding a 'group' column to each dataset, this is so we can combine them next and we can keep differentiating them. 
control_group_cleaned$group <- 'Control'
experimental_group_cleaned$group <- 'Experimental'

# Combining the datasets, this will help us compare the data in different plots.
combined_groups <- rbind(control_group_cleaned, experimental_group_cleaned)

# Visualizing the pre-trial GAD scores by group using a boxplot
ggplot(combined_groups, aes(x = group, y = pretrial_GAD, fill = group)) +
    geom_boxplot() +
    labs(title = "Pre-Trial GAD Scores by Group", x = "Group", y = "Pre-Trial GAD Score")

control_pretrial_GAD_mean <- mean(control_group_cleaned$pretrial_GAD)
control_posttrial_GAD_mean <- mean(control_group_cleaned$posttrial_GAD)
control_pretrial_GAD_mean
control_posttrial_GAD_mean

# Visualizing the post-trial GAD scores by group using a boxplot
ggplot(combined_groups, aes(x = group, y = posttrial_GAD, fill = group)) +
    geom_boxplot() +
    labs(title = "Post-Trial GAD Scores by Group", x = "Group", y = "Post-Trial GAD Score")

experimental_pretrial_GAD_mean <- mean(experimental_group_cleaned$pretrial_GAD)
experimental_posttrial_GAD_mean <- mean(experimental_group_cleaned$posttrial_GAD)
experimental_pretrial_GAD_mean
experimental_posttrial_GAD_mean

# Histogram for GAD scores
ggplot(combined_groups) +
  geom_histogram(aes(x = pretrial_GAD, fill = "Pretrial"), bins = 30, alpha = 0.6) +
  geom_histogram(aes(x = posttrial_GAD, fill = "Posttrial"), bins = 30, alpha = 0.6) +
  facet_wrap(~ group) +
  labs(title = "Histogram of GAD Scores", x = "GAD Score", y = "Score") +
  scale_fill_manual(values = c("Pretrial" = "blue", "Posttrial" = "red"))

# Density plot for GAD scores
ggplot(combined_groups, aes(x = pretrial_GAD, fill = "Pretrial")) +
  geom_density(alpha = 0.5) +
  geom_density(aes(x = posttrial_GAD, fill = "Posttrial"), alpha = 0.5) +
  scale_fill_manual(values = c("Pretrial" = "blue", "Posttrial" = "red")) +
  labs(title = "Density Plot of GAD Scores", x = "GAD Score", y = "Density") +
  facet_wrap(~ group)


```

``` {r echo=TRUE}
# Visualizing the pre-trial STAI scores by group using a boxplot
ggplot(combined_groups, aes(x = group, y = pretrial_STAI, fill = group)) +
    geom_boxplot() +
    labs(title = "Pre-Trial STAI Scores by Group", x = "Group", y = "Pre-Trial STAI Score")

control_pretrial_STAI_mean <- mean(control_group_cleaned$pretrial_STAI)
control_posttrial_STAI_mean <- mean(control_group_cleaned$posttrial_STAI)
control_pretrial_STAI_mean
control_posttrial_STAI_mean

# Visualizing the post-trial STAI scores by group using a boxplot
ggplot(combined_groups, aes(x = group, y = posttrial_STAI, fill = group)) +
    geom_boxplot() +
    labs(title = "Post-Trial STAI Scores by Group", x = "Group", y = "Post-Trial STAI Score")

experimental_pretrial_STAI_mean <- mean(experimental_group_cleaned$pretrial_STAI)
experimental_posttrial_STAI_mean <- mean(experimental_group_cleaned$posttrial_STAI)
experimental_pretrial_STAI_mean
experimental_posttrial_STAI_mean



# Histogram for STAI scores
ggplot(combined_groups) +
  geom_histogram(aes(x = pretrial_STAI, fill = "Pretrial"), bins = 30, alpha = 0.6) +
  geom_histogram(aes(x = posttrial_STAI, fill = "Posttrial"), bins = 30, alpha = 0.6) +
  facet_wrap(~ group) +
  labs(title = "Histogram of STAI Scores", x = "STAI Score", y = "Score") +
  scale_fill_manual(values = c("Pretrial" = "green", "Posttrial" = "orange"))


# Density plot for STAI scores
ggplot(combined_groups, aes(x = pretrial_STAI, fill = "Pretrial")) +
  geom_density(alpha = 0.5) +
  geom_density(aes(x = posttrial_STAI, fill = "Posttrial"), alpha = 0.5) +
  scale_fill_manual(values = c("Pretrial" = "green", "Posttrial" = "orange")) +
  labs(title = "Density Plot of STAI Scores", x = "STAI Score", y = "Density") +
  facet_wrap(~ group)


```

```{r}
# QQ plot for Control Group Pretrial GAD
qqnorm(control_group_cleaned$pretrial_GAD, main = "QQ Plot - Control Group Pretrial GAD")
qqline(control_group_cleaned$pretrial_GAD, col = "red")

# QQ plot for Control Group Posttrial GAD
qqnorm(control_group_cleaned$posttrial_GAD, main = "QQ Plot - Control Group Posttrial GAD")
qqline(control_group_cleaned$posttrial_GAD, col = "red")

# QQ plot for Experimental Group Pretrial STAI
qqnorm(experimental_group_cleaned$pretrial_GAD, main = "QQ Plot - Experimental Group Pretrial STAI")
qqline(experimental_group_cleaned$pretrial_GAD, col = "red")

# QQ plot for Experimental Group Posttrial STAI
qqnorm(experimental_group_cleaned$posttrial_GAD, main = "QQ Plot - Experimental Group Posttrial STAI")
qqline(experimental_group_cleaned$posttrial_GAD, col = "red")



```

#### Testing for Normality
##### Anderson-Darling Test
``` {r echo=FALSE}

# Anderson-Darling Test, referenced from class example https://github.com/nmcguinness/2023_MSC_DataAnalytics_IntroToR/blob/main/Examples/9_TestingForNormality.R

control_pretrial_GAD_ad <- ad.test(control_group_cleaned$pretrial_GAD)
control_posttrial_GAD_ad <- ad.test(control_group_cleaned$posttrial_GAD)
control_pretrial_STAI_ad <- ad.test(control_group_cleaned$pretrial_STAI)
control_posttrial_STAI_ad <- ad.test(control_group_cleaned$posttrial_STAI)

noquote(paste("A",control_pretrial_GAD_ad$method, "was conducted on the data."))

print_ad_results <- function(tested_data) { # create a function with the name my_function
  if(tested_data$p.value < 0.05)
  {
    noquote(paste("From the output obtained we can not assume normality as the p-value of", round(tested_data$p.value, 4), "is less than 0.05 for data:", tested_data$data))
  } else #note in R we need to put the else as shown (i.e. immediately after the { bracket) and not on a new line (as we can in C, C++, C#)
  { 
    noquote(paste("From the output obtained we can assume normality as the p-value of", round(tested_data$p.value, 4), "is greater than 0.05 for data:", tested_data$data))
  }
}



print_ad_results(control_pretrial_GAD_ad)
print_ad_results(control_posttrial_GAD_ad)
print_ad_results(control_pretrial_STAI_ad)
print_ad_results(control_posttrial_STAI_ad)

```

<<<<<<< Updated upstream
##### Shapiro-Wilk Test
``` {r echo=FALSE}
control_pretrial_GAD_sw <- shapiro.test(control_group_cleaned$pretrial_GAD)
control_posttrial_GAD_sw <- shapiro.test(control_group_cleaned$posttrial_GAD)
control_pretrial_STAI_sw <- shapiro.test(control_group_cleaned$pretrial_STAI)
control_posttrial_STAI_sw <- shapiro.test(control_group_cleaned$posttrial_STAI)

noquote(paste("A",control_pretrial_GAD_sw$method, "was conducted on the data."))

print_sw_results <- function(tested_data) { # create a function with the name my_function
  if(tested_data$p.value < 0.05)
{
  noquote(paste("From the output obtained we can not assume normality as the p-value of", round(tested_data$p.value, 4), "is less than 0.05 for data:", tested_data$data))
} else
{ 
  noquote(paste("From the output obtained we can assume normality as the p-value of", round(tested_data$p.value, 4), "is greater than 0.05 for data:", tested_data$data))
}
}



print_sw_results(control_pretrial_GAD_sw)
print_sw_results(control_posttrial_GAD_sw)
print_sw_results(control_pretrial_STAI_sw)
print_sw_results(control_posttrial_STAI_sw)
```

### Method <a name="method"></a>
=======
### Hypothesis testings

Now that we have tested for normality, we can assume that all datasets are normally distributed, this entails that we can now proceed with parametric tests. Since the dataset provided two main groups of comparison; pre-test results and post-test results, we have opted to continue with a two-sample T-test that allows the comparison of the means of two groups. It is important to note that the two groups are also independent, which is an important requirement of the chosen test. 

In order to test our hypothesis, we need to calculate the difference between the pretrial results and posttrial results for both control and experimental groups. After, that we can use the mean in both to run a two sample t-test and find a p-value that can test our hypothesis.

```{r}

# Calculate change in GAD scores
control_group_results <- control_group_cleaned$posttrial_GAD - control_group_cleaned$pretrial_GAD
experimental_group_results <- experimental_group_cleaned$posttrial_GAD - experimental_group_cleaned$pretrial_GAD

# Independent t-test for comparing changes between groups
t.test(control_group_results, experimental_group_results)

# Calculate change in STAI scores
control_group_results_STAI <- control_group_cleaned$posttrial_STAI - control_group_cleaned$pretrial_STAI
experimental_group_results_STAI <- experimental_group_cleaned$posttrial_STAI - experimental_group_cleaned$pretrial_STAI

# Independent t-test for comparing changes between groups
t.test(control_group_results_STAI, experimental_group_results_STAI)
>>>>>>> Stashed changes


```

Results for GAD Scores:

For GAD scores, the p-value is approximately 0.0000000004143. This extremely small p-value suggests that the observed difference in mean changes between the control and experimental groups is highly unlikely to have occurred by chance.

The negative mean changes in both groups suggest that GAD scores decreased in both groups after the treatment, indicating improvement. The more negative mean change in the experimental group (VR-based therapy) compared to the control group (traditional CBT) suggests a greater reduction in GAD scores, which implies that the VR-based therapy was more effective in reducing GAD scores than the traditional CBT.

In summary, based on these results, we can conclude that VR-based therapy led to a significantly greater reduction in GAD scores compared to traditional CBT in your study.

Results for STAI Scores

The negative mean change in the experimental group suggests again a reduction in STAI scores, indicating a decrease in anxiety levels after treatment. 
The positive mean change in the control group, suggests either a slight increase in STAI scores or a less substantial decrease compared to the experimental group.

Given the very low p-value, you can reject the null hypothesis that there is no difference in STAI score changes between the groups. As with previous results, the results strongly suggest that VR-based therapy was more effective in reducing anxiety levels than traditional CBT in your study.


### Results <a name="results"></a>




### Discussion <a name="discussion"></a>




### References <a name="references"></a>


- [Code for Knitr](https://argoshare.is.ed.ac.uk/healthyr_book/the-anatomy-of-a-notebook-r-markdown-file.html)
- [STAI Min & Max values](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6945947/#:~:text=Each%20question%20is%20rated%20on,T%20and%20STAI%2DS%20subscales.)
- [GAD Min & Max values](https://www.corc.uk.net/outcome-experience-measures/generalised-anxiety-disorder-assessment-gad-7/#:~:text=GAD%2D7%20total%20score%20for%20the%20seven%20items%20ranges%20from%200%20to%2021.)